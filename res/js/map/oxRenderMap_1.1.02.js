/*
 *  oxMap.UI v1.1.02
 * 
 *  author:    o'xkape WEBKARTOGRAFIE, Mike Kunert
 *  copyright: o'xkape <http://www.webkartografie.de> by <http://www.oxkape.de>
 *  date: 2012-12-29
 *
 */
"use strict";window.oxMap.Helper={OL:{transformer:{"null":null,WGS84:new OpenLayers.Projection("EPSG:4326"),OSM:new OpenLayers.Projection("EPSG:4326"),GMap:new OpenLayers.Projection("EPSG:900913"),map:function(){return oxMap.OSM.map.getProjectionObject()}},createIcon:function(e){var t=e[0],n=new OpenLayers.Size(e[1],e[2]),r=new OpenLayers.Pixel(e[3],e[4]);return new OpenLayers.Icon(t,n,r)},createBoundObject:function(e,t){var n=e.w,r=e.s,i=e.e,s=e.n,o=this,e=new OpenLayers.Bounds;e.extend(new OpenLayers.LonLat(n,r));e.extend(new OpenLayers.LonLat(i,s));if(t){e.transform(o.transformer[t],o.transformer.map())}return e}},getEvent:function(e){switch(e){case"hover":return"mouseover mouseout";break;case"click":return"click";break;default:return null}},getUsedImageType:function(){return $.browser.msie&&parseInt($.browser.version)<9?"png":"svg"},preLoadLayerImages:function(e){$.each(e,function(e,t){var n=new Image;n.src=t})}};window.oxMap.Error=function(e,t){var n=this,r="en";this.errorTypes={en:{"default":"An unknown error has occurred.",config:"Datas for configuration are missing. Please check whether your datas are correctly loaded.\n\n[oxMap.Config]",module:"Module [%p] do not exists.",map:"A map module is missed. Currently there are the following modules [OSM].",file:"Module is unverifiable.\n\nMissing: oxMap.%p.js",wms:"The map system --%p-- is not defined.",data:"Datas which want displayed are not loaded. Please check whether your datas are correctly integrated.",event:"You have not defined any layer event. By default ONCLICK was set.",custom:"There are no settings for a corporate design map."},de:{"default":"Es ist ein unbekannter Fehler aufgetreten.",config:"Konfigurationsdaten fehlen. Bitte prüfen, ob die Daten korrekt geladen werden.\n\n[oxMap.Config]",module:"Das Modul [%p] existiert nicht.",map:"Es fehlt ein Kartenmodul. Aktuelle Module sind [OSM].",file:"Modul kann nicht verarbeitet werden.\n\nDatei fehlt: oxMap.%p.js",wms:"Das Kartensystem --%p-- ist nicht definiert.",data:"Die darzustellenden Daten konnten nicht geladen werden. Bitte prüfen, ob diese eingebunden wurden.",event:"Es wurde keine Layer-Event definiert. Es wird stattdessen ONCLICK reserviert.",custom:"Die Konfigurationswerte für die Corporate Design Karte fehlen."}};this.reportError=function(e,t){alert(n.errorTypes[r][e].replace(/%p/g,t))};this.setup=function(e,t){r=oxMap.Config.language==="default"?r:oxMap.Config.language;n.reportError(e||"default",t)}(e,t)};window.oxMap.OSM={configuration:{wms:"OSM",type:"Mapnik",mapID:"oxMapArea"},osmOptions:{controls:[new OpenLayers.Control.Attribution],projection:new OpenLayers.Projection("EPSG:4326"),units:"degrees",allOverlays:true},map:null,wmsLayer:null,wms:{OSM:{Osmarender:new OpenLayers.Layer.OSM.Osmarender,Mapnik:new OpenLayers.Layer.OSM.Mapnik},GMap:{ROADMAP:new OpenLayers.Layer.Google("Google Streets",{numZoomLevels:20})}},Render:function(){var e=this,t=e.configuration,n,r,i=[];t=$.extend(e.configuration,oxMap.Config);n=t.type;r=n.length;if(!n||r<1){new oxMap.Error("wms",t.wms+" "+t.type);return false}e.osmOptions.controls=e.osmOptions.controls.concat(new oxMap.OSM.Controls(t.mapControls));for(var s=0;s<r;s+=1){i.push(e.wms[t.wms][n[s]])}oxMap.OSM.map=new OpenLayers.Map(t.mapID,e.osmOptions);oxMap.OSM.map.addLayers(i);oxMap.OSM.map.setCenter(oxMap.OSM.LonLat(t.center),t.startLevel);if(t.custom&&t.custom.bounds){oxMap.OSM.map.setOptions($.extend(oxMap.OSM.map.options,{restrictedExtent:oxMap.Helper.OL.createBoundObject(t.custom.bounds,"WGS84")}))}oxMap.OSM.wmsLayer=i;oxMap.data=rawdata||function(){new oxMap.Error("data")}()},Controls:function(e){var t,n=e.length,r=[],i;for(t=0;t<n;t+=1){if(e[t]==="Navigation"){i=new OpenLayers.Control.Navigation({zoomWheelEnabled:false})}else{i=new OpenLayers.Control[e[t]]}r.push(i)}return r},LonLat:function(e){if(e.length===2){return(new OpenLayers.LonLat(e[0],e[1])).transform(oxMap.Helper.OL.transformer.WGS84,oxMap.Helper.OL.transformer.map())}return false}};window.oxMap.OSM.Marker=function(e){var e=oxMap.data,t,n,r,i,s,o=null,u=null,a=[],f=this;this.setMarkerByCategory=function(e){for(o in e){u=e[o];if(!u.data){continue}t=new OpenLayers.Layer.Markers(o);if(u.icon){i=oxMap.Helper.OL.createIcon(u.icon)}$.each(u.data,function(e,s){var u=i.clone();r=oxMap.OSM.LonLat(s.coors);n=new OpenLayers.Marker(r,u);n.name=e;n.category=o;if(s.url){n.goToUrl=s.url;a.push(n)}$(u.imageDiv).addClass("tooltip").attr("data-catID",o).attr("data-name",e);t.addMarker(n)});oxMap.OSM.markerList.push(t)}oxMap.OSM.map.addLayers(oxMap.OSM.markerList);if(a.length>0){f.setSpecialUrl(a)}};this.setSpecialUrl=function(e){var t=$("<a></a>").addClass("markerLink"),n,r,i,s=function(e){var n=$(e.icon.imageDiv).find("img"),r=t.clone();n.wrap(r.attr("href",e.goToUrl))};if(e.length){for(r=0,n=e.length;r<n;r+=1){s(e[r])}}else{s(e)}return true};this.setup=function(){oxMap.OSM.markerList=[];OpenLayers.Marker.prototype.name="";OpenLayers.Marker.prototype.category="";OpenLayers.Marker.prototype.goToUrl=null;f.setMarkerByCategory(e)}()};window.oxMap.OSM.Tooltip=function(e){var t=$(oxMap.OSM.map.div),n=null,r=null,i=oxMap.OSM.configuration.mapMarkerEvent,s=this;this.show=function(e){e.stopPropagation();e.preventDefault();var t=$('<div class="oxTextLayer"></div>'),i=$(this),s=i.parent(),o=i.attr("data-name"),u=i.attr("data-catID"),a=oxMap.data[u]["data"][o];if(n){n.remove();n=null;r.css("z-index",r.attr("data-z"));if(e.type==="mouseout"||r.attr("id")==s.attr("id")){return true}}n=t;r=s;if(a.desc){i.append(t.html(a.desc));s.attr("data-z",s.css("z-index")).css("z-index",1e5)}};this.setup=function(){if(!i){new oxMap.Error("event");i="click"}t.on(oxMap.Helper.getEvent(i),".tooltip",s.show)}()};window.oxMap.OSM.Filter=function(e){var t=this,n,r;this.filterOnMap=function(e,t){var n;t=t||this;n=t.checked?true:false;oxMap.OSM.map.getLayersByName(t.name)[0].setVisibility(n)};this.setup=function(){n=$(oxMap.OSM.configuration.filter);r=oxMap.OSM.configuration.filterItems;n.find(r).each(function(){t.filterOnMap(null,this)});n.on("change",r,t.filterOnMap)}()};window.oxMap.OSM.CDmap=function(e){var t=this,n={},r=oxMap.Helper.getUsedImageType(),i=0,s;this.customMapLayer=function(){var e=t.customZoomLevel[0]?n[r][0]:null;return new OpenLayers.Layer.Image("customMapLayer",e,oxMap.Helper.OL.createBoundObject(n.bounds,"WGS84"),new OpenLayers.Size(n.size.w,n.size.h),{isBaseLayer:false,opacity:1,displayOutsideMaxExtent:false,alwaysInRange:true})};this.mapControl=function(){oxMap.OSM.map.events.on({zoomend:t.customZoomControl})};this.customZoomControl=function(){var e=this.getZoom();if(e>=t.zoomLevel[i]){i+=1}else{i-=1}if(i>=0&&i<=s){if(t.customZoomLevel[i]){oxMap.OSM.wmsLayer[0].setVisibility(false);t.customMapLayer.setUrl(n[r][i])}else{oxMap.OSM.wmsLayer[0].setVisibility(true);t.customMapLayer.setUrl(null)}}else if(i>s){oxMap.OSM.map.zoomTo(t.zoomLevel[s]);i=s}else{oxMap.OSM.map.zoomTo(t.zoomLevel[0]);i=0}};this.zoomLevel=[];this.customZoomLevel=[];this.setup=function(){var e,o,u;if(!oxMap.Config.custom){new oxMap.Error("custom");return false}n=$.extend(n,oxMap.Config.custom);if(n.imageType&&n.imageType==="png"){r="png"}oxMap.Helper.preLoadLayerImages(n[r]);u=oxMap.Config.startLevel;for(e=0,o=oxMap.Config.numZoomLevels;e<o;e+=1){t.zoomLevel[e]=u+e;t.customZoomLevel[e]=false}s=t.zoomLevel.length;for(e=0,o=s;e<o;e+=1){if(t.zoomLevel[e]==n.startLevel){i=e}}for(e=i,o=i+n.numZoomLevels;e<o;e+=1){t.customZoomLevel[e]=true}i=0;t.mapControl();t.customMapLayer=t.customMapLayer();oxMap.OSM.wmsLayer[0].setVisibility(false);oxMap.OSM.map.addLayer(t.customMapLayer)}()};window.oxMap.Modules={Base:true,Config:true,Helper:"init",Error:0,OSM:"map","OSM.Render":"init","OSM.CDmap":0,"OSM.Marker":"init","OSM.Tooltip":"init","OSM.Filter":0};window.oxMap.Base=function(e){function r(e){e=e.split(".");if(e.length===2){delete oxMap[e[0]][e[1]]}else{delete oxMap[e[0]]}}var t=this,n=0;this.initModules=function(){var e,t,n;for(t in oxMap.Modules){n=oxMap.Modules[t];if(n==="init"){t=t.split(".");if(t.length===2){oxMap[t[0]][t[1]]()}else{oxMap[t[0]]}}if(n===0){r(t)}}t=undefined;n=undefined;delete oxMap.Modules;delete oxMap.Config.modules};this.setup=function(e){if(!oxMap.Config){new oxMap.Error("config");return false}var r=oxMap.Config.modules,i=oxMap.Config.modules.length,s,o,u,a,f=function(e){if(typeof e=="undefined"){new oxMap.Error("file",e);return false}},l,c;for(s=0;s<i;s+=1){u=oxMap.Modules[r[s]];if(typeof u=="undefined"){new oxMap.Error("module",r[s]);continue}a=r[s].split(".");f(oxMap[a[0]]);if(a.length===2){f(oxMap[a[0]][a[1]])}oxMap.Modules[r[s]]=u===0?"init":u}for(l in oxMap.Modules){c=oxMap.Modules[l];if(c==="init"){continue}if(c==="map"){n=1;oxMap.Modules[l]=true;continue}}l=undefined;c=undefined;if(!n){new oxMap.Error("map");return false}t.initModules()}(e)};new oxMap.Base